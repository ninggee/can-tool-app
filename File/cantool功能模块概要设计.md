
### cantool功能设计

---


##### 总体框架思路：

can装置：用来收集CAN信息

cantoolapp：实现can数据的显示和控制


```
graph LR
can总线-->cantool装置
cantool装置-->cantoolapp

```



---
##### cantoolapp功能总体描述：
- 该软件需要将连接在CAN总线上的CanTool装置采集的CAN信息发送到上位机（移动终端Android、iOS、Windows PC）

- 并由运行在上位机中的CanToolApp软件接收这些信息，显示在用户图形界面上
- 同时在CanToolApp的界面上还可以设定CAN信息，通过GUI按钮将信息发送给CanTool装置，CanTool装置将按照规定的信息格式，将信息发送的CAN总线上


---

###### 核心功能部分：显示接收和发送的can信息
接受的数据显示：
- 需要进行数据的解析，得到can信息中包含的各种can信号值
- 将can信号值进一步进行计算，还原该信号所代表的物理量信息
- 显示

发送数据：

- 要发送的CAN信息也采用同种方式将用户输入的物理值转换为CAN信号
- 并依据CAN信号描述数据库将属于同一个CANID的信号合成为字符串发送给CanTool装置

例子：
计算，转化信息：

CAN信号的数值与实际它所代表的物理量的值通过phy=A*x+B来计算。其中phy代表物理量的值，A为1LSB（Least Significant Bit）代表的物理值大小，也称Factor，x是CAN信号的值，B是物理量的偏移量。例如：x=0x10=16， A=0.1℃，B=-10℃，则此CAN信号代表的物理值phy=16*0.1-10=-8.4℃。如果用户在GUI界面上输入了15℃，希望CanToolApp发送给CanTool装置并发送到CAN总线，那么就需要把此物理量的数值转换为CAN信号值x=(phy-B)/A=(15-(-10))/0.1=250=0xFA，将16进制0xFA
放到相应的CAN信息中，组成CAN信息字符串发送给CanTool装置。


---
#### 功能模块概要设计

###### 用户设置

---
- 能够搜索到本机所有可使用的COM口，并在弹出式ComboBox中以列表方式让用户选择CanTool装置在上位机中映射的COM口。并设置相应COM口波特率115200、数据位数8、停止位数1。这些设定内容可保存到CanToolApp设定文件中，供下次使用
- 能够实现CANtool装置的CAN速率设置、进入CAN工作状态（Open）、进入CAN初始化状态（ Close）。这些设定内容可保存到CanToolApp设定文件中，供下次使用



###### 数据显示
- 能够对接收到的多个CAN信息，通过CAN信息及CAN信号数据库进行解析，将CAN信息原始数据进行显示。并能对CAN信息中的CAN信号的物理值实时数据进行显示
- 显示样式：显示时可以让用户选择仪表盘方式显示接收到CAN信号物理值。这些用户选择的显示方式可保存到CanToolApp设定文件中，供下次使用。仪表盘、LED等需要自制控件
- 显示变化曲线：可以让用户选择某些接收到的CAN信号，显示其变化的实时物理值曲线


###### 保存为文件


- 可以将接收到的所有CAN信息数据，实时保存为数据文件。格式为CSV格式，或自定义

###### 发送信息
7.	能够指定要发送的多个CAN信息，并允许用户设定CAN信息中的CAN信号物理值。可以指定CAN信息的发送周期（0-65535ms即0x0000-0xFFFF）。
8.	App可将用户设定的物理值转换为CAN信号值，将CAN信息中包含的所有CAN信号合成完整的CAN信息后，发送给CanTool装置，发送到CAN总线上


###### 加载用户提供的can信息和信号数据库（不懂？？）
9.	可以加载用户提供的CAN信息和信号数据库，完成CAN信号数据的解析以及CAN发送信息的组装。可以显示CAN信号在CAN信息的布局，样例如图 9所示。未加载数据库的情况下，只显示CAN信号的原始值，即phy=A*x+B中的A=1，B=0。加载的数据库文件相关信息，可保存到CanToolApp设定文件中，供下次使用。
10.	加载用户提供的CAN信息和信号数据库，可以树状结构显示在GUI界面中。树状结构如图 10所示，供参考。
11.	可以将用户提供的CAN信息和信号数据库另存为xml和JSON (JavaScript Object Notation)格式。也可以已将xml或Json格式的数据库，转换为CAN信息和信号数据库格式。

###### 远程数据库
12.	可以将所有CAN信息实时数据、CAN设定信息等 通过WEB API方式更新到远程数据库。此时CanToolApp作为客户端与远程的Web API服务进行数据交换。此功能需要完成WebAPI服务器端的get\post等服务，实现数据的增删改查、可视化数据显示，实现数据共享。（此功能可以独立一个项目完成）


###### 可扩展性
13.	功能可能随时增加或修改，需要做好变更管理。
（考虑到可扩展性，设计页面的时候可以用slidebar）

